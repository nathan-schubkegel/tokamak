<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
	<title>adamdawes.com - Tokamak Physics - Tutorial 3</title>
    	<link rel="stylesheet" href="/styles/adamdawes.css?version=20090606" type="text/css" media="all">
	<link rel="stylesheet" type="text/css" href="/styles/menus.css?version=20090606">
	<!--[if IE]>
	<link rel="stylesheet" type="text/css" href="/styles/menusie.css">
	<![endif]-->
	<link href="/rss.html" rel="alternate" type="application/rss+xml" title="rss" />
</head>


<body>

    <div id="copyright"></div>

<table id="layoutTable" cellpadding="0" cellspacing="0">
<tr><td class="leftColumn">

	<a href="/index.html" class="logo"></a><a class="logo-preload"></a>
	&nbsp;

	<!-- Windows software -->
	<div class="menu">
	<ul>
	  <li><a href="/windows/index.html" title="Windows software"><div class="headerWindows"></div></a>
	    <ul>
	      <li><div class="linksWindows"><a class="linkpopup" href="/windows8/index.html">Windows 8 software</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenuTitle">Applications</div></li>
	        <li><div class="linksSubMenu"><a href="/windows8/win8_rsscentral.html" title="Powerful RSS feed reader">RSS Central</a></div></li>
	        <li><div class="linksSubMenuTitle">Games</div></li>
	        <li><div class="linksSubMenu"><a href="/windows8/win8_tilefall.html" title="Addictive tile-based strategy game">Tile Fall</a></div></li>
	        <li><div class="linksSubMenu"><a href="/windows8/win8_frotz8.html" title="An interpreter for Interactive Fiction games">Frotz8</a></div></li>
	        <li><div class="linksSubMenu"><a href="/windows8/win8_wordsup.html" title="A fun strategic word game for between 2 and 4 players">WordsUp</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	      <li><div class="linksWindows"><a class="linkpopup" href="/books/index.html">Windows 8 Books</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/books/w8wp8gamedev.html" title="Windows 8 and Windows Phone 8 Game Development">Windows 8 and Windows Phone 8 Game Development</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	      <li><div class="linksWindows"><a class="linkpopup" href="/windows/index.html">Windows software</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenuTitle">Applications</div></li>
	        <li><div class="linksSubMenu"><a href="/windows/win_tellyprompter.html" title="UK TV listings guide and reminder service">TellyPrompter</a></div></li>
	        <li><div class="linksSubMenuTitle">Children's</div></li>
	        <li><div class="linksSubMenu"><a href="http://www.icangames.com/ican/games/presskeys.html" title="Fun game for 1-3 year old children">I Can Press Keys</a></div></li>
	        <li><div class="linksSubMenuTitle">Games</div></li>
	        <li><div class="linksSubMenu"><a href="/windows/win_hpursuit.html" title="Fast-paced action-packed arcade driving game">Highway Pursuit</a></div></li>
	        <li><div class="linksSubMenu"><a href="/windows/win_tilefall.html" title="Addictive tile-based strategy game">Tile Fall</a></div></li>
	        <li><div class="linksSubMenuTitle">Screen savers</div></li>
	        <li><div class="linksSubMenu"><a href="/windows/win_scr_polymorf3d.html" title="An endless parade of spinning multicoloured 3D shapes">Polymorf 3D</a></div></li>
	        <li><div class="linksSubMenu"><a href="/windows/win_scr_snowfall.html" title="A shower of beautiful snowflakes">SnowFall</a></div></li>
	        <li><div class="linksSubMenu"><a href="/windows/win_scr_twinklegl.html" title="Showers of coloured stars">TwinkleGL</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	    </ul>
	  </li>
	  <li><div class="footerWindows"></div>
	</ul>
	</div>
	<!-- Windows Phone -->
	<div class="menu">
	<ul>
	  <li><a href="/wp7/index.html" title="Windows Phone software"><div class="headerWindowsMobile"></div></a>
	    <ul>

	      <li><div class="titleWindowsMobile">Windows Phone</div>

	      <li><div class="linksWindowsMobile"><a class="linkpopup" href="/wp7/index.html">Software</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenuTitle">Applications</div></li>
	        <li><div class="linksSubMenu"><a href="/wp7/wp7_rsscentral.html" title="Powerful RSS feed reader">RSS Central</a></div></li>
	        <li><div class="linksSubMenuTitle">Games</div></li>
	        <li><div class="linksSubMenu"><a href="/wp7/wp7_tilefall.html" title="Addictive tile-based strategy game">Tile Fall</a></div></li>
	        <li><div class="linksSubMenu"><a href="/wp7/wordsup.html" title="Fun strategic word game for two to four players">WordsUp</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>

	      <li><div class="linksWindowsMobile"><a class="linkpopup" href="/books/index.html">Books</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/books/wp7gamedev.html" title="Windows Phone 7 Game Development">Windows Phone 7 Game Development</a></div></li>
	        <li><div class="linksSubMenu"><a href="/books/w8wp8gamedev.html" title="Windows 8 and Windows Phone 8 Game Development">Windows 8 and Windows Phone 8 Game Development</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>

	      <li><div class="sepWindowsMobile"></div>
	      <li><div class="titleWindowsMobile">Windows Mobile</div>

	      <li><div class="linksWindowsMobile"><a class="linkpopup" href="/windowsmobile/index.html">Software</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenuTitle">Games</div></li>
	        <li><div class="linksSubMenu"><a href="/windowsmobile/winmob_gemdrops.html" title="Fun and frantic puzzle game">GemDrops</a></div></li>
	        <li><div class="linksSubMenu"><a href="/windowsmobile/winmob_pocketzax.html" title="An interpreter for interactive fiction adventure games">PocketZax</a></div></li>
	        <li><div class="linksSubMenu"><a href="/windowsmobile/winmob_tilefall.html" title="Addictive tile-based strategy game">Tile Fall</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>

	      <li><div class="linksWindowsMobile"><a class="linkpopup" href="/books/index.html">Books</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/books/wmgamedev.html" title="Windows Mobile Game Development">Windows Mobile Game Development</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	    </ul>
	  </li>
	  <li><div class="footerWindowsMobile"></div>
	</ul>
	</div>
	<!-- Programming -->
	<div class="menu">
	<ul>
	  <li><a href="/programming/index.html" title="Programming"><div class="headerProgramming"></div></a>
	    <ul>
	      <li><div class="linksProgramming"><a class="linkpopup" href="/books/index.html">Books</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/books/wmgamedev.html" title="Windows Mobile Game Development">Windows Mobile Game Development</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	      <li><div class="linksProgramming"><a class="link" href="/programming/tokamak/index.html">Tokamak Physics</a></div></li>
	      <li><div class="linksProgramming"><a class="link" href="/programming/vs2005/index.html">Visual Studio</a></div></li>
	      <li><div class="linksProgramming"><a class="link" href="/programming/vb/index.html">Visual Basic 6</a></div></li>
	      <li><div class="linksProgramming"><a class="link" href="/programming/windows/index.html">Windows</a></div></li>
	      <li><div class="linksProgramming"><a class="link" href="/programming/opl/index.html">OPL</a></div></li>
	    </ul>
	  </li>
	  <li><div class="footerProgramming"></div>
	</ul>
	</div>
	<!-- Retro gaming -->
	<div class="menu">
	<ul>
	  <li><a href="/retrogaming/index.html" title="Retro gaming"><div class="headerRetrogaming"></div></a>
	    <ul>
	      <li><div class="linksRetrogaming"><a class="linkpopup" href="/retrogaming/index.html">Retro Gamer articles</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/retrogaming/rg_04_pias.html" title="An article exploring the music chip from the Commodore 64">Play it again, SID</a></div></li>
	        <li><div class="linksSubMenu"><a href="/retrogaming/rg_08_bubblebobble.html" title="A trip to the wonderful world of Taito's Bubble Bobble">Bubble Trouble</a></div></li>
	        <li><div class="linksSubMenu"><a href="/retrogaming/rg_17_playtowin.html" title="Ever wondered who won all those fantastic 80s game competitions?">Play to Win</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	      <li><div class="linksRetrogaming"><a class="linkpopup" href="/retrogaming/index.html">Arcade projects</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/retrogaming/mamecab.html" title="My upright MAME arcade cabinet">MAME Cabinet</a></div></li>
	        <li><div class="linksSubMenu"><a href="/retrogaming/drivingcab.html" title="A sit-down 'cockpit'-style driving cabinet">Driving Cabinet</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	      <li><div class="linksRetrogaming"><a class="linkpopup" href="/retrogaming/index.html">Game guides</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/retrogaming/bbguide/index.html" title="Complete level guide for Bubble Bobble">Bubble Bobble</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	    </ul>
	  </li>
	  <li><div class="footerRetrogaming"></div>
	</ul>
	</div>
	<!-- Ringtones -->
<!--
	<div class="menu">
	<ul>
	  <li><a href="/nokia/index.html" title="Ring-tones"><div class="headerRingtones"></div></a>
	    <ul>
	      <li><div class="linksRingtones"><a class="link" href="/nokia/tones.html">Polyphonic ring-tones</a></div></li>
	      <li><div class="linksRingtones"><a class="link" href="/nokia/howto_ringtones_index.html">Transferring via WAP</a></div></li>
	    </ul>
	  </li>
	  <li><div class="footerRingtones"></div>
	</ul>
	</div>
-->
	<!-- Psion software -->
	<div class="menu">
	<ul>
	  <li><a href="/psion/index.html" title="Psion software"><div class="headerPsion"></div></a>
	    <ul>
	      <li><div class="linksPsion"><a class="linkpopup" href="/psion/index.html">EPOC software</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/psion/epoc_tilefall.html" title="Addictive tile-based strategy game">Tile Fall</a></div></li>
	        <li><div class="linksSubMenu"><a href="/psion/epoc_reaction.html" title="Explosive turn-based strategy game">Chain Reaction</a></div></li>
	        <li><div class="linksSubMenu"><a href="/psion/epoc_blobs.html" title="Fast paced Tetris-style game">Blobs</a></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	      <li><div class="linksPsion"><a class="linkpopup" href="/psion/index.html">SIBO software</a></div>
	        <ul>
	        <li><div class="headerSubMenu"></div></li>
	        <li><div class="linksSubMenu"><a href="/psion/sibo_tilefall.html" title="Addictive tile-based strategy game">Tile Fall</a></div></li>
	        <li><div class="linksSubMenu"><a href="/psion/sibo_reaction.html" title="Explosive turn-based strategy game">Chain Reaction</a></div></li>
	        <li><div class="footerSubMenu"></div></li>
	        </ul>
	      </li>
	    </ul>
	  </li>
	  <li><div class="footerPsion"></div>
	</ul>
	</div>
	<!-- Amiga -->
	<div class="menu">
	<ul>
	  <li><a href="/amiga/index.html" title="Amiga software"><div class="headerAmiga"></div></a>
	    <ul>
	      <li><div class="linksAmiga"><a class="link" href="/amiga/index.html">Amiga software</a></div></li>
	    </ul>
	  </li>
	  <li><div class="footerAmiga"></div>
	</ul>
	</div>
	<!-- Miscellaneous -->
	<div class="menu">
	<ul>
	  <li><a href="/misc/index.html" title="Miscellaneous"><div class="headerMisc"></div></a>
	    <ul>
	      <li><div class="linksMisc"><a class="link" href="/oldnews.html">Old news</a></div></li>
	      <li><div class="linksMisc"><a class="link" href="/misc/links.html">Links</a></div></li>
	      <li><div class="linksMisc"><a class="link" href="/misc/donate.html">Donate</a></div></li>
	      <li><div class="linksMisc"><a class="link" href="/misc/contact.html">Contact me</a></div></li>
	    </ul>
	  </li>
	  <li><div class="footerMisc"></div>
	</ul>
	</div>
	<!-- Search -->
	<div class="navBox">
		<div class="headerSearch"></div>
		<div class="linksSearch" style="padding-bottom:8px">
			<div style="margin-left:6px">
			<!-- SiteSearch Google -->
			<FORM method=GET action="http://www.google.com/search">
			<input type=hidden name=ie value=UTF-8>
			<input type=hidden name=oe value=UTF-8>
			<center>
			
			<A HREF="http://www.google.com/"><img style="margin-bottom:10px" src="/styles/images/google-logo.gif" width="81" height="34" alt="Google" border="0"></A><br>
			<INPUT TYPE=text name=q size=21 maxlength=255 value="" style="text-align: center">
			<INPUT style="margin-top:5px" type=submit name=btnG VALUE="Search this site">
			<input type=hidden name=domains value="adamdawes.com"><input type=hidden name=sitesearch value="adamdawes.com" checked>
			</center>
			</FORM>
			<!-- SiteSearch Google -->
			</div>
		</div>
		<div class="footerSearch"></div>
	</div>


    <div class="headerSubMenu-preload"></div>
    <div class="linksSubMenu-preload"></div>
    <div class="footerSubMenu-preload"></div>

	
	<div id="minilogo"></div>
	
	
	
</td>
<td class="rightColumn">

	<div id="topNavigation">
		<div id="utilityLinks">
			<a href="/misc/contact.html" class="contact"></a>
			<a href="/misc/contact.html" class="contact-preload"></a>
			<a href="/index.html" class="home"></a>
			<a href="/index.html" class="home-preload"></a>
			<a href="http://twitter.com/AdamDawes575" style="float: right; height: 36px; overflow: hidden; margin-right: 20px;">
				<img src="/styles/images/twitter.png" />
		 	</a>
		 	<br clear="all">
		</div>
	</div>

	<div id="contentHeader">
		<div id="contentHeaderLeft"></div>
		<div id="contentHeaderMid"></div>
		<div id="contentHeaderRight"></div>
	</div>
	<div id="contentFrame">
	
		<div id="content">

    <!-- PAGE CONTENT STARTS HERE -->

    <div id="breadcrumbs"><a href="/index.html">Home</a><a href="../index.html">Programming</a><a href="index.html">Tokamak Physics</a>Tutorial 3, cylinders and spheres</div>

	<img align="right" src="files/TutImage3.jpg" alt="Tutorial screenshot">
	<h2>Tutorial 3, cylinders and spheres</h2></p>

	<p>In addition to the boxes presented in the previous tutorial, Tokamak is able to model the movement of two additional
	primitives: spheres and cylinders. This tutorial examines the properties of each, and how to set them up in a
	Tokamak simulation.</p>

	<h3>Spheres</h3>
	
	<p>Spheres are probably the simplest of all primitives to work with as they 
	only have a single property to describe their dimensions: their diameter. To 
	add a sphere to the simulation, the following code is used (in the 
	<code>InitPhysics</code> procedure of the tutorial code):</p>
	
	<br clear="all">
<blockquote class="code">
    // Set the parameters for the spheres
    fMass = 100.0f;

    // Create some spheres
    for (i=0; i&lt;SPHERECOUNT; i++)
    {
        gSpheres[i] = gSim-&gt;CreateRigidBody();
        geom = gSpheres[i]-&gt;AddGeometry();
        // Tell the geometry that we want a sphere and set its size
        geom-&gt;SetSphereDiameter(SPHEREDIAM);
        // Update the bounding information
        gSpheres[i]-&gt;UpdateBoundingInfo();
        // Set the inertia tensor -- again we use the sphere diameter here
        gSpheres[i]-&gt;SetInertiaTensor(
                        neSphereInertiaTensor(SPHEREDIAM, fMass));
        gSpheres[i]-&gt;SetMass(fMass);
        // Slightly randomise the position to make it more interesting
        pos.Set((float)(rand()%10) / 100, fYPos, (float)(rand()%10) / 100);
        gSpheres[i]-&gt;SetPos(pos);

        // Set the angular damping for the object
        gSpheres[i]-&gt;SetAngularDamping(0.01f);

        // Increase the height for the next object
        fYPos += fYPosAdd;
    }
</blockquote>

	<p>In the previous tutorial which dealt only with boxes, I defined the 
	coordinates for rendering the box directly in the sourcecode. For spheres 
	and cylinders, the definition of the objects are quite a lot more complex, 
	and so I have chosen to create two procedures in the code to generate vertex 
	buffer data for these objects.</p>

	<p>I won't go into much detail about how each of these work as they have 
	very little to do with the Tokamak engine. If you wish to use them in your 
	own projects then feel free to take them, otherwise spheres and cylinders 
	can always be read from an external geometry file (a .X, .3ds, etc. file) 
	and used in the same way.</p>

	<p>The procedure to generate a vertex buffer for a sphere is called 
	BuildSphere. It accepts two parameters: a pointer to the 
	IDirect3DVertexBuffer8 pointer into which the address of the vertex buffer 
	will be written, and the diameter of the sphere to be generated. This should 
	of course be the same diameter as passed to Tokamak or the simulation will 
	look very strange.</p>

	<p>BuildSphere uses only surface normals when generating its vertices, so 
	there is no smooth shading around the object. This could be changed fairly 
	easily to use vertex normals, but is not necessary for the purposes of this 
	tutorial.</p>

	<h3>Cylinders</h3>
	
	<p>Unfortunately, Tokamak cylinders are possibly not quite what you expect 
	them to be. They are indeed cylindrical, but the ends are rounded in a 
	"sausage" shape. This can limit the usefulness of cylinders but they are 
	still a worthwhile primitive to explore.</p>
	
	<p>Cylinders have two dimensions used to define them, their diameter and their height. The dimensions are used to form
	the cylinder as follows:</p>
	
	<p align="center"><img src="files/03_CylinderDimensions.gif" alt="Cylinder dimensions"></p>
	
	<p>This actually gives cylinders a lot in common with spheres. In fact, if a 
	cylinder's height is reduced to zero then it becomes a sphere.</p>
	
	<p>Cylinders are also added to the simulation in the 
	<code>InitPhysics</code> procedure using the following code:</p>

<blockquote class="code">
    // Set the parameters for the cylinders
    fMass = 100.0f;

    // Create some cylinders
    for (i=0; i&lt;CYLINDERCOUNT; i++)
    {
        gCylinders[i] = gSim-&gt;CreateRigidBody();
        geom = gCylinders[i]-&gt;AddGeometry();
        // Tell the geometry that we want a cylinder and set its size
        geom-&gt;SetCylinder(CYLINDERDIAM, CYLINDERHEIGHT);
        // Update the bounding information
        gCylinders[i]-&gt;UpdateBoundingInfo();
        // Set the inertia tensor -- again we use the diameter and height here
        gCylinders[i]-&gt;SetInertiaTensor(
                        neCylinderInertiaTensor(CYLINDERDIAM, CYLINDERHEIGHT, fMass));
        gCylinders[i]-&gt;SetMass(fMass);
        // Slightly randomise the position to make it more interesting
        pos.Set((float)(rand()%10) / 100, fYPos, (float)(rand()%10) / 100);
        gCylinders[i]-&gt;SetPos(pos);

        // Set the angular damping for the object
        gCylinders[i]-&gt;SetAngularDamping(0.01f);

        // Increase the height for the next object
        fYPos += fYPosAdd;
    }
</blockquote>

	<p>The simulation now contains a number of cubes, spheres and cylinders all 
	positioned one above the next and all ready to drop into view. However, 
	there are a couple of other things we should consider before we start 
	running the simulation.</p>

	<h3>Friction</h3>
	
	<p>There is one important property shared by spheres and cylinders that does 
	not apply to cubes: they roll. By default, Tokamak will not apply any 
	friction or other damping force to rolling objects, so they will continue to 
	roll or spin forever. This can create some "spinning-top"-like effects with 
	cylinders, which will spin for hours around the floor, but this is not very 
	realistic for a real-life simulation.</p>

	<p>A simple friction can be applied to the objects using the 
	<code>SetAngularDamping</code> method of each rigid body. This has the 
	effect of continually moving the spin of the object along all axes towards 
	zero. Because of this, rolling objects will gradually slow down until they 
	stop.</p>

	<p>An important point to note however is that the angular damping applies to 
	the object at all times, not just when it is touching the ground.</p>

	<p>The <code>InitPhysics</code> code above sets the angular damping to 
	<code>0.01f</code> for both the spheres and cylinders. This value results in 
	the objects slowing down as they roll but doesn't visibly affect the objects 
	while they are in motion in the air. Smaller values for this parameter will 
	cause the objects to decrease in speed more slowly. Larger values will cause 
	this to occur more quickly, but may have noticeable effects such as stopping 
	the objects from spinning while they are in mid-air.</p>

	<h3>Bounciness</h3>

	<p>The final property to look at in this tutorial is the "bounciness" of 
	objects in the simulation. Bounciness can be controlled by creating a 
	material and assigning it to a body. Materials have two properties: friction 
	and restitution.</p>

	<p>Friction controls how much the movement of an external object is reduced 
	when it collides with the material. It only has any effect when the objects 
	actually collide and bounce, however: once the object has stopped bouncing 
	and is rolling, this parameter has no effect (though according to the 
	Tokamak team, this is a bug which should be fixed in a future release of the 
	library). For this reason we still need to use the angular damping described 
	above.</p>

	<p>Restitution is the property that controls how high objects will bounce. 
	When two objects collide, the restitution values of the two objects are 
	added together and the resulting value is used to calculate how they bounce 
	against one another. It is therefore possible to use a negative value for 
	restitution for one object to cancel out the restitution of another. A 
	resulting value less than or equal to zero will not cause any bounce at 
	all.</p>

	<p>Materials are created by calling the <code>SetMaterial</code> method of 
	the simulator object. The method expects a material ID to be passed as the 
	first parameter. If an ID is passed that has not previously been used, a new 
	material will be created using that ID. The remaining parameters are used to 
	pass the friction and restitution for the material.</p>

	<p>A material with ID zero is created automatically by the Tokamak engine 
	and is assigned to all bodies when they are first created. It has a friction 
	value of 0.4, and a restitution of 0.5.</p>

	<p>Materials can be assigned to a body using the 
	<code>SetMaterialIndex</code> method of the <code>neGeometry</code> object. 
	Once the material has been created as described above, simply pass its index 
	to this function.</p>

	<p>In our simulation we will increase the bounciness of the floor by 
	assigning a material to its geometry. The code to achieve this is as 
	follows: </p>

<blockquote class="code">
    // Create an animated body for the floor
    gFloor = gSim-&gt;CreateAnimatedBody();
    // Add geometry to the floor and set it to be a box
    // with size as defined by the FLOORSIZE constant
    geom = gFloor-&gt;AddGeometry();
    boxSize1.Set(FLOORSIZE, 0.2f, FLOORSIZE);
    geom-&gt;SetBoxSize(boxSize1[0],boxSize1[1],boxSize1[2]);
    gFloor-&gt;UpdateBoundingInfo();
    // Set the material for the floor
    gSim-&gt;SetMaterial(MATERIAL_FLOOR, 0.4f, 1.3f);
    geom-&gt;SetMaterialIndex(MATERIAL_FLOOR);
    // Set the position of the box within the simulator
    pos.Set(0.0f, -3.0f, 0.0f);
    gFloor-&gt;SetPos(pos);
</blockquote>

	<p>Note that this only increases the bounciness of the floor, not of any of 
	the other objects. To change their bounciness either create a second 
	material to assign to them, or use <code>SetMaterial</code> to change 
	properties of the material with index zero, which will affect all objects in 
	the simulation unless a different material index has been applied to 
	them.</p>

	<h3>Spice it up</h3>

	<p>Just to make the simulation a bit more interesting to look at, we do two 
	more things in the <code>Render</code> procedure. The first thing we'll do 
	is to slowly swing the camera around the origin of the render space.</p>
	
<blockquote class="code">
    D3DXMATRIX view_matrix;
    D3DXMatrixLookAtLH(&amp;view_matrix,
                &amp;D3DXVECTOR3(
                    sinf(gfCameraAngle*0.2f)*25,
                    10.0f,
                    cosf((gfCameraAngle+0.1f)*0.25f)*25 ),
                &amp;D3DXVECTOR3( 0.0f, 0.0f, 0.0f ),
                &amp;D3DXVECTOR3( 0.0f, 1.0f, 0.0f ));
    gD3DDevice-&gt;SetTransform(D3DTS_VIEW,&amp;view_matrix);
    // Update the camera angle
    gfCameraAngle += fElapsed;
</blockquote>

	<p>If you prefer a fixed camera position, remove these lines of code.</p>

	<p>Finally, we'll periodically reset the simulation so that all object 
	positions are reinitialised. This allows the simulation to run again and 
	again without any user intervention. Resetting the simulation is achieved 
	quite simply by destroying the Tokamak simulator (which clears all of its 
	objects) and then reinitialising it all again.</p>
	
<blockquote class="code">
    // Periodically reset the object positions
    gfSceneTime += fElapsed;
    if (gfSceneTime &gt; 20)
    {
        KillPhysics();
        InitPhysics();
        gfSceneTime = 0;
    }
</blockquote>

	<p>That concludes this tutorial. The source code and a compiled executable for this tutorial are available in
	the following .zip file.</p>

	<p><center>
	<a href="files/TokamakTutorial3.zip"><img src="../../gfx/ico_zip.gif" border="0" alt="Zip icon"></a>
	<br>
	<a href="files/TokamakTutorial3.zip">TokamakTutorial3.zip</a>
	</center>
 
	<table width="100%">
	 <tr>
	  <td align="left">&lt;&lt; <a href="02_Cubes.html">Tutorial 2, colliding cubes</a> &lt;&lt;</td>
	  <td align="right">&gt;&gt; <a href="04_TerrainMesh.html">Tutorial 4, terrain mesh</a> &gt;&gt;</td>
	 </tr>
	</table>
 
	<hr>

	<p>If you have any comments or suggestions regarding this article, please don't hesitate to <a href="../../misc/contact.html">contact me</a>.</p>
	<p align="right"><font size=-2>This article is copyright &copy; Adam Dawes, 2003.<br>It may not be copied or redistributed without my express written permission.</font></p>

    <!-- PAGE CONTENT ENDS HERE -->

    		</div>
		
	</div>

	<div id="contentFooter">
		<div id="contentFooterLeft"></div>
		<div id="contentFooterMid"></div>
		<div id="contentFooterRight"></div>
	</div>

</td></tr>
</table>

<script type="text/javascript">
//<![CDATA[
(function() {
	var links = document.getElementsByTagName('a');
	var query = '?';
	for(var i = 0; i < links.length; i++) {
		if(links[i].href.indexOf('#disqus_thread') >= 0) {
			query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
		}
	}
	document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/adamdawes/get_num_replies.js' + query + '"></' + 'script>');
})();
//]]>
</script>

</body>

</html>
